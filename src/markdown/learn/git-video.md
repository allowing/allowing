# GIT教程 - 视频配套课件

## 初始化一个本地仓库

为了学习的方便可以可以在桌面新建一个文件夹，起名为 learn-git 。打开 git 命令行客户端，运行以下命令即可初始化一个本地仓库。
```
git init
```
当运行了以上命令，git 会在当前目录新建一个名为 .git 的隐藏文件夹，这个文件夹就是 git 的仓库文件夹。

## 查看配置、修改配置

学习一款工具的时候，首先应该认识它的配置。运行一下命令可以查看git的配置。
```
# 查看所有配置
git config --list
# 查看本地配置
git config --local --list
# 查看全局配置
git config --global --list
# 查看系统配置
git config --system --list
```
git 的配置是有三份配置文件合成的，分别是本地配置，配置文件保存在当前仓库中，全局配置，配置保存在当前 Windows 登录用户的家目录下，系统配置，配置文件保存在 git 的安装目录下的某个目录中。当有相同配置项时，本地配置的优先级较高，全局配置次之，系统配置优先级最低。

修改配置的命令如下

```
# 不加配置文件选项默认配置的是本地配置
git config 配置项 "配置值"
# 配置本地配置（可以不加 --local 选项，默认就是本地配置）
git config --local 配置项 "配置值"
# 配置全局配置
git config --global 配置项 "配置值"
# 配置系统配置
git config --system 配置项 "配置值"
```

如配置用户名的命令如下

```
git config --global user.name "allowing"
```

如果这个电脑经常是自己本人使用，可以将用户名配置成全局的，不然就把它配置成本地的。

```
git config --local user.name "allowing"
```

## 查看帮助

git 查看帮助很简单，如下给出的命令。需要一定的英文能力。

```
# 查看 git 命令的帮助
git
# 查看某个子命令的帮助
git 子命令 -h
```

例如查看 config 子命令的帮助

```
git config -h
```

如果运行以下命令会打开一张网页，这个网页有更详细的帮助说明

```
git config --help
```

## 工作区、暂存区、仓库

工作区是指当前编辑代码的文件夹，也是 .git 仓库所在的文件夹。

暂存区只是一个概念，实际上并不存在这个区。

仓库就是 .git 文件夹了，它是我们运行 git init 命令时自动创建的，默认是隐藏的，所有的历史都保存在这里。

## 查看状态

查看状态命令用得很频繁，命令如下

```
git status
```

git 会把文件的变化列出来，例如未跟踪的文件，已修改的文件，已删除的文件等，将会被提交的文件列表等。良好的习惯是在操作之前先查看一下状态。

## 跟踪文件

初始化一个仓库时，仓库是空空的，要运行以下命令，让 git 跟踪某文件。

```
git add 文件名
```
运行以上命令就把一个文件跟踪起来了，这个文件就进入了暂存区。

## 提交

在提交之前先配置好 user.name 和 user.email 两个配置项先。配置的原则是如果这台电脑是你自己使用的就全局配置，不然就本地配置。

全局配置：

```
git config --global user.name "your name"
git config --global user.email "your email"
```

本地配置：

```
git config --local user.name "your name"
git config --local user.email "your email"
```

提交是指把暂存区的文件提交到 git 仓库，可以通过以下命令进行

```
git commit -m "提交说明"
```

提交同时也是一个名词，在 git 中一个提交就是一个历史，每个提交都有一个唯一的提交 id

## 修订最近的一次提交

最近的一次提交在未和远程仓库同步之前，修改起来都是很容易的，如果发现某个文件的内容有误，可以在工作区把这个文件改正，然后又不想重新做成一个单独的提交，可以把这次的修改作为一个修订，修订最近的一次提交，操作还是跟之前一样，跟踪修改，提交，只是在提交时加上 --amend 选项

```
git commit --amend -m "提交说明"
```

修订提交不会重新生成一个单独的提交记录。

## 查看日志

查看日志是指查看提交的记录，可以运行以下命令查看

```
git log
```

还可以显示得简洁一点，加上 --oneline 选项

```
git log --oneline
```

单行显示模式下的 提交 id 也变短了，注意这个提交 id 也是可以进行某些操作的，和长长的提交 id 具有相同的功能。

## 检出文件

检出文件是指从提交中拿出一个文件到工作区，例如当想放弃某个文件的修改时，就可以这样做。

```
git checkout 文件名
```
例如我改了 README.md 可是改着改着我不想改了，就可以从历史中检出这个文件覆盖到当前工作区。

```
git checkout README.md
```

以上是从最近的一次提交中检出，还可以指定一个提交 id，指定从这次提交中检出。

```
# 设某次提交 id 为 1e25af6
git checkout 1e25af6 README.md
```

提交 id 可以运行 "git log --oneline" 查看

## 远程仓库

远程仓库是指保存在远程计算机的仓库，这个仓库和本地仓库保持同步，那么这样子就相当于把本地仓库漫游了，去到哪就都可以访问了，还可以和世界上其他有志小伙伴分享。

远程仓库提供商有很多，其中最著名的莫过于 github 了，它是目前全球最大的代码托管平台，可惜服务器是在国外的，可能是我国的原因吧，访问速度有点慢。中国的仓库提供商比较出名的是开源中国了。本教程就以开源中国为例，讲解怎么和远程仓库交互。

## 注册开源中国账号

填写好注册信息注册一个账号，这个没有什么难度的。

## 生成本机的 ssh

在 git 的命令行工具下，运行以下命令，然后所有的提示都默认不填，一路按三次回车，生成公私钥

```
ssh-keygen
```

这样就会在用户的家目录下的 .ssh 目录下生成公私钥对。

id_rsa 私钥

id_rsa.pub 公钥

用文本编辑器打开公钥，全选里面的内容，复制到开源中国，在用户的设置里能看到对应选项的。

当把本机的公钥添加到了开源中国之后，git 命令行工具就可以和开源中国的仓库连接了。

## 新建一个远程的空白仓库

在刚刚注册好的账号，新建一个公开的空白的仓库，注意一定要空白的，不要用 README.md 初始化这个仓库。

然后把刚新建的仓库的 ssh 地址复制，添加到要同步的本地仓库。

```
git remote add <远程仓库名字> <远程仓库地址>
```

远程仓库名字随便起，一般叫 "origin" ，远程仓库地址就是刚刚复制的 ssh 地址。例如

```
git remote add origin git@git.oschina.net:allowing/class001-homework.git
```

公开的仓库是指人人都可以查看，人人都可以克隆。里面的代码也叫开源的代码，因为大家都可以克隆嘛，但是开源不代表没有原则，也是要遵循开源协议的。

私有的仓库是指个人的仓库，其他小伙伴不能查看不能克隆。

我本人的开源精神是：片段开源，系统闭源。

## 推送本地仓库到远程

配置好远程仓库地址之后，就可以推送本地的仓库到远程了。具体运行以下命令，首次推送应该加上 "-u" 选项，这样就会在远程仓库建立一个与推送的分支同名的关联分支，这个本地分支叫做远程分支的跟踪分支也叫上游分支。

```
# 首次推送加上 -u 选项
git push -u <远程仓库名> <要推送的分支名>

# 如
git push -u origin master

# 下次再推送这个分支就不用加任何选项了，甚至在当前分支下还可以直接推送
git push
```

跟踪分支：跟踪分支是指和远程分支具有关联关系的分支，一般保持它们两者同名。跟踪分支也叫上游分支。

更多关于分支的内容，往后会继续学到，暂时先用默认的 master 分支联系。

推送本地仓库的原则是，完成了一定的工作之后就要及时推送到远程。

## 认识开源中国仓库

推送了本地仓库到远程之后，再到线上查看，各个链接按钮都点击一下，认识认识它们。

## 拉取远程仓库的更新到本地

实际工作中，我们可能会在各台电脑推送推送代码到远程，那么其他电脑就要及时拉取远程的更新下来。

设当前 master 分支是远程仓库 origin/master 分支的跟踪分支，则可以运行以下命令拉取

```
git pull
```

如果当前 master 分支没有和远程的 origin/master 分支存在跟踪关系，那么这种关系一般是不正常的，这里我们不作介绍，因为新手难理解，老手又不会犯，而且解释起来语言难组织^_^。

## 克隆一个远程仓库

克隆仓库是指把线上的仓库“复制”一份到本地。

```
git clone <远程仓库地址>
```

当克隆完之后，git 会自动检出一个活动分支到当前的工作区，这个分支也已经和远程的分支建立起了跟踪关系，提交到了本地仓库的提交可以直接运行 "git push" 推送到远程仓库。

## 分支

分支是指一条挂载了“提交”的历史进程，可以到网上找找形象的分支图解。master 分支是默认分支，也是默认的活动分支。

### 新建分支

新建分支可以运行以下命令

```
git branch <分支名>
# 如新建一个 test 分支
git branch test
```

上面的操作是基于当前分支分叉出的分支，历史的提交也会在刚刚新建的分支出现。


### 基于给定提交 id 新建分支

基于给定的提交 id 新建分支。设某提交 id 为 abc123, 以下命令则可以基于这个提交 id 分叉出一条分支

```
git branch <分支名> <提交 id>
# 如基于 abc123 新建 test-for-commit-id 分支
git branch test-for-commit-id abc123
```

### 切换到新建的分支

```
git checkout <分支名>
# 如切换到 test 分支
git checkout test
```

切换到新建的分支之后工作区的内容也会跟着改变。

实际中，往往新建一个分支之后要马上切换过去的，所以有以下简便方式

```
git checkout -b <新分支名>
# 基于给定提交 id
git checkout -b <新分支名> <提交 id>
```

### 检出一个远程仓库的分支

克隆完一个仓库之后，git 只是检出默认分支一般是 master，但是要检出其他远程分支就要手动检出了，注意一般检出一个远程分支同时要建立起跟踪关系的，不建立跟踪关系是没有意义的。

```
git checkout --track 远程主机名/分支名
# 设存在远程分支 origin/test
git checkout --track origin/test
```

--track 选项是建立跟踪关系的意思

## 结束语

git 是一款强大的工具，同时学习它也是一件不容易的事情，熟练掌握它就更难了。能用好它，那么它将会是一个好帮手，用不好就会被它牵着走。

建议新手写一个留言板，并使用它进行版本控制，在这个过程中慢慢体会它的好。最好能买一台服务器，不是共享的，是有独立操作系统的，能远程登录的，不会 linux 系统的同学可以买 windows 系统的，就好像操作自己的主机一样。
